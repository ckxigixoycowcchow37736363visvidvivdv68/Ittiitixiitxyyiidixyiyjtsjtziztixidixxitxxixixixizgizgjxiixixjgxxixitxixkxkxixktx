<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soul Bank Game</title>
<style>
body { font-family: Arial; background: #f5f5f5; text-align: center; padding: 50px; }
#balance { font-size: 24px; margin-bottom: 20px; }
button { padding: 10px 20px; font-size: 18px; cursor: pointer; margin: 5px; }
</style>
</head>
<body>

<h1>üíé Soul Bank Game</h1>
<div id="balance">Balance: Loading...</div>

<button onclick="buyCard(50)">Buy Card (50 SOUL)</button>
<button onclick="buyCard(100)">Buy Card (100 SOUL)</button>
<button onclick="refreshBalance()">Refresh Balance</button>

<script>
const USER_ID = 12345; // Example user id, change per user
const BASE_URL = "http://0.0.0.0:5001"; // Replace with Termux IP

async function refreshBalance() {
    try {
        const res = await fetch(`${BASE_URL}/balance?user_id=${USER_ID}`);
        const data = await res.json();
        if(data.balance !== undefined){
            document.getElementById("balance").innerText = `Balance: ${data.balance} SOUL`;
        } else {
            document.getElementById("balance").innerText = `Error: ${data.error}`;
        }
    } catch(e) {
        document.getElementById("balance").innerText = "Error connecting to server";
    }
}

async function buyCard(amount) {
    try {
        const res = await fetch(`${BASE_URL}/deduct`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ user_id: USER_ID, amount: amount })
        });
        const data = await res.json();
        if(data.new_balance !== undefined){
            alert(`‚úÖ Card bought! New Balance: ${data.new_balance}`);
            refreshBalance();
        } else {
            alert(`‚ö†Ô∏è Error: ${data.error}`);
        }
    } catch(e) {
        alert("‚ö†Ô∏è Connection error");
    }
}

// Initial load
refreshBalance();
</script>

</body>
</html>
